<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Times - Dropdown Customization</title>
    
    <style>
        /* ================================================= */
        /* === START OF style.css CONTENT (Embedded CSS) === */
        /* ================================================= */

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: #0d1117; 
            color: #c9d1d9; 
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            box-sizing: border-box;
        }

        .world-clock-container {
            text-align: center;
            width: 100%;
            max-width: 900px;
        }

        h1 {
            font-size: 2.5em;
            color: #58a6ff; 
            margin-bottom: 30px;
        }

        /* --- Clock Grid Styles --- */
        .clock-grid {
            display: flex;
            flex-wrap: wrap; 
            gap: 20px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .clock-card {
            background-color: #161b22;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            flex: 1 1 200px; 
            min-width: 150px;
            transition: transform 0.3s ease;
        }

        .clock-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.7);
        }

        .city-name {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
            color: #c9d1d9;
        }

        .time-display {
            font-size: 3em;
            font-weight: 300;
            letter-spacing: 2px;
            color: #ffffff;
            margin-bottom: 5px;
        }

        .date-display {
            font-size: 0.9em;
            color: #8b949e;
        }

        /* --- New Customizer & Dropdown Styles --- */

        .customize-button, .save-button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            transition: background-color 0.3s;
        }

        .customize-button {
            background-color: #58a6ff;
            color: #0d1117;
        }

        .save-button {
            background-color: #238636; /* Green for save */
            color: #ffffff;
            margin-left: 10px;
        }

        .customize-button:hover {
            background-color: #79c0ff;
        }

        .save-button:hover {
            background-color: #31a44a;
        }

        .customizer-panel {
            background-color: #161b22;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            text-align: left;
            border: 1px solid #30363d;
        }

        .customizer-panel h2 {
            margin-top: 0;
            font-size: 1.5em;
            color: #ffffff;
        }

        #cityInputs {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        /* Style for the select dropdown */
        .input-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #30363d;
            border-radius: 4px;
            background-color: #0d1117;
            color: #c9d1d9;
            box-sizing: border-box;
            appearance: none; /* Remove default browser styling for a custom look */
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23c9d1d9%22%20d%3D%22M287%20114.3L167.3%20234.1c-4.1%204.1-10.7%204.1-14.8%200L5.4%20114.3c-4.1-4.1-4.1-10.7%200-14.8s10.7-4.1%2014.8%200l139.7%20139.7L272.2%2099.5c4.1-4.1%2010.7-4.1%2014.8%200s4.1%2010.7%200%2014.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 10px top 50%;
            background-size: 10px auto;
            cursor: pointer;
        }

        .feedback-message {
            color: #238636;
            font-weight: bold;
            margin-top: 10px;
        }


        /* --- iPhone 13 (Mobile) Compatibility --- */
        @media (max-width: 768px) {
            
            .clock-grid {
                flex-direction: column; 
                gap: 15px;
            }

            .clock-card {
                flex: 1 1 100%; 
                padding: 20px;
            }

            .time-display {
                font-size: 2.5em; 
            }
        }
        /* =============================================== */
        /* === END OF style.css CONTENT (Embedded CSS) === */
        /* =============================================== */
    </style>
</head>
<body>
    <div class="world-clock-container">
        <h1>Global Timezones ðŸŒŽ</h1>
        
        <div class="clock-grid" id="clockGrid">
            </div>

        <button id="showCustomizerButton" class="customize-button">Customize Cities</button>

        <div id="customizer" class="customizer-panel" style="display:none;">
            <h2>Select Your Timezones</h2>
            <p>Choose 4 timezones from the dropdown lists:</p>
            <div id="cityInputs">
                </div>
            <button id="saveCitiesButton" class="save-button">Save Changes</button>
            <p class="feedback-message" id="feedbackMessage"></p>
        </div>
    </div>
    
    <script>
        /* ================================================= */
        /* === START OF script.js CONTENT (Embedded JS) === */
        /* ================================================= */
        
        // A list of common, user-friendly IANA Timezones
        // This list is manually curated for a better user experience than including all ~600 zones.
        const ALL_TIMEZONES = [
            // North and South America
            "America/New_York (EST)",
            "America/Los_Angeles (PST)",
            "America/Chicago (CST)",
            "America/Denver (MST)",
            "America/Vancouver",
            "America/Toronto",
            "America/Mexico_City",
            "America/Sao_Paulo (Brazil)",
            
            // Europe and Africa
            "Europe/London (GMT)",
            "Europe/Paris (CET)",
            "Europe/Berlin (CET)",
            "Europe/Moscow",
            "Africa/Cairo",
            "Africa/Lagos",
            
            // Asia and Middle East
            "Asia/Dubai",
            "Asia/Kolkata (India)",
            "Asia/Shanghai",
            "Asia/Tokyo",
            "Asia/Manila (Philippines)",
            "Asia/Singapore",
            "Asia/Seoul",
            
            // Australia and Pacific
            "Australia/Sydney (AEST)",
            "Australia/Perth",
            "Pacific/Auckland (NZST)",
            "Pacific/Honolulu",
            
            // Standard Time Offsets (for generic use)
            "Etc/GMT+12 (GMT-12)",
            "Etc/GMT+1 (GMT-1)",
            "Etc/GMT-1 (GMT+1)",
            "Etc/GMT-12 (GMT+12)",
        ];

        // Default cities (used if nothing is saved in localStorage)
        const DEFAULT_CITIES = [
            { name: "New York, USA", timezone: "America/New_York" },
            { name: "Europe/London (GMT)", timezone: "Europe/London" },
            { name: "Asia/Tokyo", timezone: "Asia/Tokyo" },
            { name: "Australia/Sydney (AEST)", timezone: "Australia/Sydney" }
        ];

        let currentCities = [];

        // --- 1. LOCAL STORAGE & INITIALIZATION ---

        function loadCities() {
            const savedCities = localStorage.getItem('worldClockCities');
            if (savedCities) {
                currentCities = JSON.parse(savedCities);
            } else {
                // Map default cities to the format expected by the dropdowns
                currentCities = DEFAULT_CITIES.map(city => ({
                    name: ALL_TIMEZONES.find(tz => tz.startsWith(city.timezone)) || city.name,
                    timezone: city.timezone
                }));
            }
        }

        function saveCities() {
            localStorage.setItem('worldClockCities', JSON.stringify(currentCities));
        }

        // --- 2. TIME & DATE UPDATING ---

        function formatTimeAndDate(timezone) {
            const now = new Date();
            
            const timeOptions = {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hourCycle: 'h23',
                timeZone: timezone
            };
            
            const dateOptions = {
                weekday: 'short',
                month: 'short',
                day: 'numeric',
                year: 'numeric',
                timeZone: timezone
            };

            const timeString = new Intl.DateTimeFormat('en-US', timeOptions).format(now);
            const dateString = new Intl.DateTimeFormat('en-US', dateOptions).format(now);
            
            return { timeString, dateString };
        }

        function updateAllClocks() {
            currentCities.forEach((city, index) => {
                const timeDisplay = document.getElementById(`time-${index}`);
                const dateDisplay = document.getElementById(`date-${index}`);
                
                if (timeDisplay && dateDisplay) {
                    const { timeString, dateString } = formatTimeAndDate(city.timezone);
                    timeDisplay.textContent = timeString;
                    dateDisplay.textContent = dateString;
                }
            });
        }

        // --- 3. RENDERING CLOCKS ---

        function renderClocks() {
            const clockGrid = document.getElementById('clockGrid');
            clockGrid.innerHTML = '';
            
            currentCities.forEach((city, index) => {
                const card = document.createElement('div');
                card.className = 'clock-card';
                card.setAttribute('data-timezone', city.timezone);
                
                // Use the displayed name (before the first space/parenthesis) for card title
                let displayName = city.name.split('(')[0].trim();
                displayName = displayName.split('/').pop().replace('_', ' ');

                card.innerHTML = `
                    <p class="city-name">${displayName}</p>
                    <div class="time-display" id="time-${index}">--:--:--</div>
                    <p class="date-display" id="date-${index}">--/--/----</p>
                `;
                clockGrid.appendChild(card);
            });
            
            updateAllClocks();
        }

        // --- 4. CUSTOMIZATION PANEL LOGIC (DROPDOWN IMPLEMENTATION) ---

        /**
         * Generates the dropdown select fields inside the customizer panel.
         */
        function renderCustomizerInputs() {
            const cityInputsDiv = document.getElementById('cityInputs');
            cityInputsDiv.innerHTML = '';

            // Ensure we have exactly 4 dropdowns
            for (let i = 0; i < 4; i++) {
                const inputGroup = document.createElement('div');
                inputGroup.className = 'input-group';
                
                const label = document.createElement('label');
                label.setAttribute('for', `city-select-${i}`);
                label.textContent = `Clock ${i + 1}:`;
                
                const select = document.createElement('select');
                select.id = `city-select-${i}`;
                
                // 1. Add a default 'Select a City' option
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = '--- Select a City / Timezone ---';
                select.appendChild(defaultOption);

                // Determine the currently selected timezone for this slot (if saved)
                const currentTZ = currentCities[i] ? currentCities[i].timezone : '';

                // 2. Populate options from the ALL_TIMEZONES list
                ALL_TIMEZONES.forEach(tzLabel => {
                    // Extract the actual timezone identifier (e.g., 'America/New_York')
                    const timezoneId = tzLabel.split(' ')[0];
                    
                    const option = document.createElement('option');
                    option.value = timezoneId;
                    option.textContent = tzLabel;

                    // Pre-select the option if it matches the current saved value
                    if (timezoneId === currentTZ) {
                        option.selected = true;
                    }
                    select.appendChild(option);
                });

                inputGroup.appendChild(label);
                inputGroup.appendChild(select);
                cityInputsDiv.appendChild(inputGroup);
            }
        }

        /**
         * Handles the saving of new cities selected by the user from the dropdowns.
         */
        document.getElementById('saveCitiesButton').addEventListener('click', () => {
            const newTimezones = [];
            const feedbackMessage = document.getElementById('feedbackMessage');
            
            // Collect the new selected timezone identifiers
            for (let i = 0; i < 4; i++) {
                const selectElement = document.getElementById(`city-select-${i}`);
                const timezoneValue = selectElement.value.trim();
                
                if (timezoneValue) {
                    // Find the full label (e.g., "America/New_York (EST)") for the name property
                    const nameLabel = ALL_TIMEZONES.find(tz => tz.startsWith(timezoneValue)) || timezoneValue;
                    
                    newTimezones.push({ 
                        name: nameLabel,
                        timezone: timezoneValue 
                    });
                }
            }
            
            if (newTimezones.length > 0) {
                currentCities = newTimezones;
                saveCities();
                renderClocks();
                
                feedbackMessage.textContent = 'Cities saved successfully!';
                feedbackMessage.style.color = '#238636'; 

                // Hide the customizer after a short delay
                setTimeout(() => {
                    document.getElementById('customizer').style.display = 'none';
                    document.getElementById('showCustomizerButton').textContent = 'Customize Cities';
                    feedbackMessage.textContent = ''; // Clear feedback after hiding
                }, 2000);
                
            } else {
                feedbackMessage.textContent = 'Please select at least one timezone.';
                feedbackMessage.style.color = '#ff6347';
            }
        });


        /**
         * Toggles the visibility of the customization panel.
         */
        document.getElementById('showCustomizerButton').addEventListener('click', (e) => {
            const customizer = document.getElementById('customizer');
            if (customizer.style.display === 'none' || customizer.style.display === '') {
                renderCustomizerInputs(); // Regenerate dropdowns every time it opens
                customizer.style.display = 'block';
                e.target.textContent = 'Hide Customizer';
            } else {
                customizer.style.display = 'none';
                e.target.textContent = 'Customize Cities';
                document.getElementById('feedbackMessage').textContent = '';
            }
        });

        // --- 5. INITIALIZATION ---

        function init() {
            loadCities();
            renderClocks();
            
            // Start the update loop
            setInterval(updateAllClocks, 1000); 
        }

        // Run the application
        init();
        
        /* =============================================== */
        /* === END OF script.js CONTENT (Embedded JS) === */
        /* =============================================== */
    </script>
</body>
</html>
